<div class="min-h-full flex items-center justify-center p-6">
    <div class="bg-white p-5 rounded-xl shadow-2xl w-full max-w-4xl">
        <div class="flex justify-end mb-4">
            <p-button rounded label="Create Trip" icon="pi pi-plus" (onClick)="openDraw()" />
        </div>

        <p-table
            [value]="trips.value()?.items || []"
            [customSort]="true"
            (sortFunction)="sortBy($event)"
        >
            <ng-template pTemplate="header">
                <tr>
                    <th>Trip Name</th>
                    <th pSortableColumn="city">City <p-sortIcon field="city" /></th>
                    <th pSortableColumn="startDate">Start Date <p-sortIcon field="startDate" /></th>
                    <th pSortableColumn="endDate">End Date <p-sortIcon field="endDate" /></th>
                    <th></th>
                    <th></th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-trip>
                <tr>
                    <td>{{ trip.name }}</td>
                    <td>{{ trip.city }}</td>
                    <td>{{ trip.startAt | date: 'dd-MM-yyyy' }}</td>
                    <td>{{ trip.endAt | date: 'dd-MM-yyyy' }}</td>
                    <td>
                        <i class="pi pi-eye cursor-pointer" (click)="openDraw(trip)"></i>
                    </td>
                    <td>
                        <i
                            class="pi pi-trash cursor-pointer"
                            (click)="showDeleteDialog(trip.id)"
                        ></i>
                        <p-dialog
                            header="You are about to delete {{ trip.name }}"
                            [modal]="true"
                            [(visible)]="isDeleteDialogVisible"
                        >
                            <p>Are you sure you want to delete this trip?</p>
                            <p class="mb-4">This action cannot be undone.</p>

                            <div class="flex justify-end gap-2">
                                <div
                                    class="px-4 py-2 bg-gray-300 text-gray-800 rounded-full cursor-pointer hover:bg-gray-400 transition"
                                    (click)="isDeleteDialogVisible = false"
                                >
                                    Cancel
                                </div>

                                <div
                                    class="px-4 py-2 bg-[#ad9c8e] border-[#ad9c8e] text-white rounded-full cursor-pointer hover:bg-[#9a8a7e] hover:border-[#9a8a7e] transition"
                                    (click)="deleteTrip(trip.id)"
                                >
                                    Delete
                                </div>
                            </div>
                        </p-dialog>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="6" class="text-center py-4">
                        @if (trips.error()) {
                            <p>Error while loading trips</p>
                        } @else if (trips.isLoading()) {
                            <p>Loading trips...</p>
                        } @else {
                            <p>No trips available.</p>
                        }
                    </td>
                </tr>
            </ng-template>
        </p-table>

        <p-paginator
            (onPageChange)="onPageChange($event)"
            [first]="(page() - 1) * pageSize"
            [rows]="pageSize"
            [totalRecords]="totalRecords()"
            [showCurrentPageReport]="true"
            [showPageLinks]="false"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords}"
        ></p-paginator>

        <app-trip-drawer
            [(visible)]="isDrawOpen"
            [selectedTrip]="selectedTrip()"
            [companions]="companions()"
            [interests]="interests()"
            [travelStyles]="travelStyles()"
            (submit)="onTripSubmit($event)"
        ></app-trip-drawer>
    </div>
</div>
